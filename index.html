<!DOCTYPE html>

<html>

    <head>
        <title>Time Investment</title>
        <meta charset="utf-8">
    </head>

    <body>
        <form>
            <div id="input" style="
                         -webkit-box-sizing: border-box;
                            -moz-box-sizing: border-box;
                                 box-sizing: border-box;
                         display: block;
                         margin: 180px auto;
                         width: 700px;
                         height: 250px;
                         padding: 30px;
                         box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),
                                     0 6px 20px 0 rgba(0,0,0,0.2);

                         visibility: visible;
                   " >

                <input placeholder="Which television series?" id="name" type="input" required
                       style="  display: block;
                                height: 30px;
                                width: 500px;
                                margin: 30px auto 30px;
                                padding: 10px;
                                border: 2px solid #7b68ee;

                                text-align: center;
                                color: #7b68ee;
                                font: 400 18px/22px Helvetica, Arial, sans-serif;
                              " />

                  <input type="button" onclick="getSeries()" value="Show Time"
                         style="  display: block;
                                  margin: 30px auto 30px;
                                  height: 50px;
                                  width: 200px;
                                  padding: 10px;
                                  border: 2px solid #7b68ee;

                                  text-align: center;
                                  background: #7b68ee;
                                  color: #fff;
                                  font: 400 18px/22px Helvetica, Arial, sans-serif;
                                " />

            </div>
        </form>

        <div id="result" style="
                     -webkit-box-sizing: border-box;
                        -moz-box-sizing: border-box;
                             box-sizing: border-box;
                     display: block;
                     margin: 180px auto;
                     width: 1000px;
                     padding: 30px;
                     box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),
                                 0 6px 20px 0 rgba(0,0,0,0.2);

                     visibility: hidden;
               " >

        </div>

    </body>

    <script type="text/javascript">

        let show;

        function getImage(imageUri) {

            let imageUrl = 'http://image.tmdb.org/t/p/w185' + imageUri;

            // let data = "{}";
            // let xhr = new XMLHttpRequest();
            //
            // xhr.addEventListener("readystatechange", function () {
            //   if (this.readyState === this.DONE) {
            //
            //     console.log(JSON.parse(this.response));
            //     let res = JSON.parse(this.response);
            //
            //     let show = document.createElement('div');
            //     show.setAttribute('style',resultDivStyle);
            //     show.innerHTML = '<strong>Name</strong>: ' + res.results[i].name + '<br>'
            //                        + '<strong>Summary</strong>: ' + res.results[i].overview + '<br>';
            //     element.appendChild(show);
            //   }
            // });
            //
            // xhr.open("GET", nameApiUrl);
            //
            // xhr.send(data);

            let image = document.createElement('img');
            image.setAttribute('src',imageUrl);
            show.appendChild(image);
        }

        function getSeries() {

            let nameOfSeries = document.getElementById('name').value;
            let inputDiv = document.getElementById('input');
            let resultDiv = document.getElementById('result');
            let nameApiUrl = 'https://api.themoviedb.org/3/search/tv?api_key=c3b10b85e7b9f342239ab6fd3a6fea88&language=en-US&page=1&query='
                                + nameOfSeries;

            let resultDivStyle = `
                                     display: block;
                                     margin: 30px auto 30px;
                                     width: 800px;
                                     padding: 20px;
                                     border: 2px solid #7b68ee;

                                     text-align: center;
                                     color: #000;
                                     font: 400 18px/22px Helvetica, Arial, sans-serif;`;


            let data = "{}";
            let xhr = new XMLHttpRequest();

            xhr.addEventListener("readystatechange", function () {
              if (this.readyState === this.DONE) {

                inputDiv.style.visibility = 'hidden';
                resultDiv.style.visibility = 'visible';
                console.log(JSON.parse(this.response));

                let res = JSON.parse(this.response);

                for(let i = 0; i < res.total_results; ++i) {

                    show = document.createElement('div');
                    show.setAttribute('style',resultDivStyle);
                    show.innerHTML = '<strong>Name</strong>: ' + res.results[i].name + '<br>'
                                   + '<strong>Summary</strong>: ' + res.results[i].overview + '<br>';
                    resultDiv.appendChild(show);

                    getImage(res.results[i].poster_path);
                }
              }
            });

            xhr.open("GET", nameApiUrl);

            xhr.send(data);
        }

    </script>

</html>
